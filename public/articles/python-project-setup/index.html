<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8" />
  <title>Armand Sauzay</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  
  <link rel="stylesheet" href="/css/output.css">
  
  
  <link rel="stylesheet" href="/css/syntax.css">
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="min-h-screen flex flex-col font-sans">
  <header>
  <div class="max-w-5xl mx-auto flex items-center justify-between px-6 py-5 border-b border-gray-200">
    <a href="/" class="text-green-800 font-bold text-xl hover:text-green-900">armandsauzay</a>
    <nav class="flex items-center space-x-8">
      <a href="/articles" class="flex items-center gap-1 text-gray-700 hover:text-green-800">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open-icon lucide-book-open"><path d="M12 7v14"/><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg>
        Articles
      </a>
      <a href="/projects" class="flex items-center gap-1 text-gray-700 hover:text-green-800">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-code-xml-icon lucide-code-xml"><path d="m18 16 4-4-4-4"/><path d="m6 8-4 4 4 4"/><path d="m14.5 4-5 16"/></svg>
        Projects
      </a>
      <a href="/creative-lab" class="flex items-center gap-1 text-gray-700 hover:text-green-800">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-brain-icon lucide-brain"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"/><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"/><path d="M3.477 10.896a4 4 0 0 1 .585-.396"/><path d="M19.938 10.5a4 4 0 0 1 .585.396"/><path d="M6 18a4 4 0 0 1-1.967-.516"/><path d="M19.967 17.484A4 4 0 0 1 18 18"/></svg>
        Creative Lab
      </a>
    </nav>
  </div>
</header>
  <main class="flex flex-1 flex-col">
    
<article class="mx-auto px-6 py-8" style="max-width: 44rem;">
  <header class="mb-12">
    <h1 class="text-4xl font-bold text-gray-900 mb-6">How to Properly Setup Your Python Project</h1>
    
    
    
    
    
    <div class="mb-6">
      
<div class="flex items-center text-sm text-gray-500">
  <span>5 Jun 2023</span>
  <span class="px-2">‚Ä¢</span>
  <span>11 min read</span>
  
  <span class="px-2">‚Ä¢</span>
  <div class="flex flex-wrap gap-2">
    
    <span class="bg-gray-100 px-2 py-1 rounded text-xs">python</span>
    
    <span class="bg-gray-100 px-2 py-1 rounded text-xs">bestpractices</span>
    
  </div>
  
</div>
    </div>
  </header>
  
  <div class="article-content">
    <p>As you start working on your python project, you will likely need to set it up
in a consistent and collaboration-friendly way. In this article, I&rsquo;ll describe a
setup that works great for my projects. It includes many industry best practices
and aims at explaining how to install python, run automated checks in a GitOps
fashion and structure your project.</p>
<p>This article covers quite a few topics. To ease the reading, I&rsquo;ve split each topic into two parts:</p>
<ul>
<li>üìö indicates the <strong>theory</strong> part</li>
<li>üõ†Ô∏è indicates the <strong>practical</strong> part (i.e. the commands you need to run).</li>
</ul>
<p>Sometimes you will also see a üí° section, indicating a tip or a trick.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#1-install-a-python-version-manager">Install a Python version manager</a></li>
<li><a href="#2-choose-an-environment-manager-poetry">Choose an environment manager (poetry)</a></li>
<li><a href="#3-alternatively-use-docker-as-a-dev-environment-instead">Alternatively, use Docker as a Dev Environment instead</a></li>
<li><a href="#4-add-some-code">Add Some Code</a></li>
<li><a href="#5-write-some-tests">Write Some Tests</a></li>
<li><a href="#6-lint-your-code">Lint your code</a></li>
<li><a href="#7-automate-checks-on-local-with-pre-commit">Automate checks on local with pre-commit</a></li>
<li><a href="#8-automate-checks-on-remote-with-github-actions">Automate checks on remote with GitHub Actions</a></li>
<li><a href="#9-automate-your-release-with-github-actions">Automate your release with GitHub Actions</a></li>
<li><a href="#10-enjoy-the-benefits-of-your-new-code-practices">Enjoy the benefits of your new code practices</a></li>
</ol>
<h2 id="1-install-a-python-version-manager">1. Install a Python version manager</h2>
<p>üìö The first thing you will need to do is to install a python version manager. A
python version manager will allow you to install multiple versions of python on
your machine and switch between them easily.</p>
<p>To illustrate this, let&rsquo;s say you have a project that requires python 3.6 and
another project that requires python 3.7. If you only have python 3.7 installed
on your machine, you will have to uninstall it and install python 3.6 every time
you want to work on the first project&hellip; This is where a python version manager
comes in handy.</p>
<p>You can use <a href="https://github.com/pyenv/pyenv">pyenv</a> for this and follow the
<a href="https://github.com/pyenv/pyenv#installation">installation instructions</a>.</p>
<p>üõ†Ô∏è At the time of writing this document, you can install pyenv by running the
following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl https://pyenv.run <span class="p">|</span> bash
</span></span></code></pre></div><p>If you want more control over the installation, on mac for instance you can run:</p>
<ol>
<li>
<p>Use brew to install pyenv</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install pyenv
</span></span></code></pre></div></li>
<li>
<p>Depending on the shell you use, add pyenv to your PATH.</p>
<p>üí° If you&rsquo;re not sure which shell you&rsquo;re using, you can run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">$SHELL</span>
</span></span></code></pre></div><p>For bash:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;export PYENV_ROOT=&#34;$HOME/.pyenv&#34;&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;command -v pyenv &gt;/dev/null || export PATH=&#34;$PYENV_ROOT/bin:$PATH&#34;&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;eval &#34;$(pyenv init -)&#34;&#39;</span> &gt;&gt; ~/.bashrc
</span></span></code></pre></div><p>For zsh:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;export PYENV_ROOT=&#34;$HOME/.pyenv&#34;&#39;</span> &gt;&gt; ~/.zshrc
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;command -v pyenv &gt;/dev/null || export PATH=&#34;$PYENV_ROOT/bin:$PATH&#34;&#39;</span> &gt;&gt; ~/.zshrc
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;eval &#34;$(pyenv init -)&#34;&#39;</span> &gt;&gt; ~/.zshrc
</span></span></code></pre></div></li>
</ol>
<h2 id="2-choose-an-environment-manager-poetry">2. Choose an environment manager (poetry)</h2>
<p>üìö Now that you have a python version manager, you will need to install an
environment manager. An environment manager will allow you to create isolated
environments for your projects. This is useful when you work on multiple
projects that require different versions of the same package. And it is a great
practice overall to make sure anyone can run your project.</p>
<p>To illustrate this, let&rsquo;s say you have a project that requires <code>pandas</code> and
<code>matplotlib</code> to do some data analysis and another project that requires
<code>tensorflow</code> to do some machine learning. It is considered a good practice to
create a separate environment for each project. This way, you can install
only the packages you need for each project and avoid any conflicts between
packages.</p>
<p>There are many environment managers (pipenv, conda, virtualenv, python
built-in venv, etc&hellip;). I personally use <a href="https://python-poetry.org/">poetry</a>.</p>
<p>In general, your environment manager will be installed with your python version.
For instance, if you use pyenv, you can install poetry by running the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pyenv install 3.10.6
</span></span><span class="line"><span class="cl">pyenv global 3.10.6
</span></span><span class="line"><span class="cl">pip install poetry
</span></span></code></pre></div><p>In this case, poetry will live in your python environment. This means that
you can have a different version of poetry for each python version you have
installed on your machine.</p>
<p>üõ†Ô∏è Pip installing poetry in your python environment with pip is one way to do it but you can also follow the steps below:</p>
<ol>
<li>
<p>Use the curl command to install poetry</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -sSL https://install.python-poetry.org <span class="p">|</span> python3 -
</span></span></code></pre></div></li>
<li>
<p>Add poetry to your PATH. On MacOS, poetry is added at <code>~/Library/Application Support/pypoetry/venv/bin/poetry</code>. So you can add it to your PATH by adding the
following line to your ~/.bashrc or ~/.zshrc file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/Library/Application Support/pypoetry/venv/bin:</span><span class="nv">$PATH</span><span class="s2">&#34;</span>
</span></span></code></pre></div><p>If you are using a different shell, you can find the path to poetry by running the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">poetry config --list --local <span class="p">|</span> grep virtualenvs.path
</span></span></code></pre></div><p>And then add it to your PATH.</p>
</li>
</ol>
<h2 id="3-alternatively-use-docker-as-a-dev-environment-instead">3. Alternatively, use Docker as a Dev Environment instead</h2>
<p>If you don&rsquo;t want to install a python version manager and an environment
manager, or want to abstract this for your team, you can use Docker instead. I
won&rsquo;t go into too many details here but if you&rsquo;re interested, VSCode has a great
<a href="https://code.visualstudio.com/docs/devcontainers/containers">integration with
Docker</a></p>
<h2 id="4-add-some-code">4. Add Some Code</h2>
<p>üìö Now that you have a python version manager and an environment manager, you
can start working on your project. Let&rsquo;s write some simple functions to get
started. For illustration purposes we&rsquo;ll create a simple CLI that prints &ldquo;Hello
<code>&lt;name&gt;</code>&rdquo; when you run it and give how many repositories <code>&lt;name&gt;</code> has on GitHub.</p>
<p>üí° By default, poetry wants you to create a package with a folder named as your
git repository (with the only difference that it wants underscores instead of dashes). So if your git
repository is called <code>python-project-template</code>, poetry will create a folder
called <code>python_project_template</code>.</p>
<p>üí° You can find the code for this section at <a href="https://github.com/armand-sauzay/hello-world-cli">armand-sauzay/hello-world-cli</a></p>
<p>In this case let&rsquo;s call our project <code>hello-world</code>. So we&rsquo;ll create a folder
called <code>hello_world</code> and add a file called <code>__init__.py</code> to it.</p>
<p>üõ†Ô∏è Use gh to create a new repository called <code>hello-world</code> and clone it to your
machine:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gh repo create &lt;your-github-username&gt;/hello-world-cli --template armand-sauzay/python-template --public
</span></span></code></pre></div><p>To initialize your project, run the following command (it comes from the template above):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./script/bootstrap
</span></span></code></pre></div><p>Add the requests package to your project:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">poetry add requests
</span></span></code></pre></div><p>So far, we ran the following commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pyenv install 3.10.6 <span class="c1"># install python 3.10.6</span>
</span></span><span class="line"><span class="cl">pyenv global 3.10.6 <span class="c1"># (optional) set python 3.10.6 as the default python version</span>
</span></span><span class="line"><span class="cl">pip install poetry <span class="c1"># install poetry as a python package in your python 3.10.6 environment</span>
</span></span><span class="line"><span class="cl">poetry add requests <span class="c1"># add the requests package to your project</span>
</span></span></code></pre></div><p>In <code>hello_world_cli</code> folder a file called <code>main.py</code> and add the following code to it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">argparse</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;--name&#34;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&#34;The name to greet and count repos for&#34;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&#34;world&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Username cannot be empty&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Hello </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">repos</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;https://api.github.com/users/</span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/repos&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">repos</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to fetch repos for </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">repos</span> <span class="o">=</span> <span class="n">repos</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;You have </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">repos</span><span class="p">)</span><span class="si">}</span><span class="s2"> repos.&#34;</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></span></code></pre></div><p>There are a few tricks here that are worth mentioning:</p>
<ul>
<li>We use <code>argparse</code> to parse the arguments passed to our CLI. This is a built-in
python package that allows you to parse arguments passed to your CLI.</li>
<li>We use <code>argv</code> to pass the arguments to our main function. This is useful for
testing purposes. We can pass a list of arguments to our main function and
test it without having to run the CLI.</li>
<li>We use <code>SystemExit</code> to exit our program. This is a built-in python exception
that allows you to exit your program with a specific exit code (0 for success, 1 for failure).</li>
</ul>
<h2 id="5-write-some-tests">5. Write Some Tests</h2>
<p>üìö Now that you have a few basic methods, you can start writing some tests. Tests make sure your code behaves as expected. There
are many types of tests (unit tests, integration tests, end-to-end tests, etc&hellip;)
but in this article, we will focus on unit tests. Unit tests are tests that
check the smallest unit of your code (i.e. a function or a method).</p>
<p>üõ†Ô∏è Create a file called <code>test_main.py</code> and add the following code to it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">hello_world_cli.cli</span> <span class="kn">import</span> <span class="n">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test_main</span><span class="p">(</span><span class="n">capsys</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">main</span><span class="p">([</span><span class="s1">&#39;--name&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># test is a user which does not have any contributions since 2010. </span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Hopefully this will not change in the future and the test will not break.</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">out</span> <span class="o">==</span> <span class="s1">&#39;Hello test!</span><span class="se">\n</span><span class="s1">You have 5 repos.</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">err</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test_main_empty_name</span><span class="p">(</span><span class="n">capsys</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">main</span><span class="p">([</span><span class="s1">&#39;--name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">out</span> <span class="o">==</span> <span class="s1">&#39;Username cannot be empty</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">err</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span>
</span></span></code></pre></div><ul>
<li>We use <code>capsys</code> to capture the output of our CLI. This is a pytest built-in that allows you to capture the output of your CLI.</li>
</ul>
<h2 id="6-lint-your-code">6. Lint your code</h2>
<p>üìö Now that you have some tests, you can start linting your code. Linting is the
process of checking your code for potential errors. There are many linters out
there (pylint, flake8, black, etc&hellip;). I personally use flake8, black, isort and
mypy. Ruff is also becoming quite popular and replaces flake8 and isort.</p>
<p>üõ†Ô∏è To install flake8, black, isort and mypy, you can run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">poetry add --dev flake8 black isort mypy
</span></span></code></pre></div><p>Then you can use mypy to check your code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">poetry run mypy hello_world_cli/cli.py
</span></span></code></pre></div><p>You can use flake8 to check your code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">poetry run flake8 hello_world_cli/cli.py
</span></span></code></pre></div><p>You can use black to format your code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">poetry run black hello_world_cli/cli.py
</span></span></code></pre></div><p>But you would not really want to run these commands manually every time you
change your code. This is where pre-commit comes in handy, to both make sure you
don&rsquo;t commit wrongly formatted code and to not have to run these commands
manually.</p>
<p>Also, do note that some of these linters have small incompatible differences.
For example, black will complain if you have a line longer than 88 characters,
but flake8 will complain if you have a line longer than 79 characters. You need
to configure them to work correctly together:</p>
<ul>
<li>you should create a .flake8 file with the following content:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>flake8<span class="o">]</span>
</span></span><span class="line"><span class="cl">max-line-length <span class="o">=</span> <span class="m">88</span>
</span></span><span class="line"><span class="cl">extend-ignore <span class="o">=</span> E203
</span></span></code></pre></div><ul>
<li>you should create a .isort.cfg file with the following content:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>settings<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">profile</span> <span class="o">=</span> black
</span></span></code></pre></div><ul>
<li>you can read more on the <a href="https://black.readthedocs.io/en/stable/guides/using_black_with_other_tools.html">black documentation</a></li>
</ul>
<h2 id="7-automate-checks-on-local-with-pre-commit">7. Automate checks on local with pre-commit</h2>
<p>üìö Now that you have some tests and some linters, you can start automating your
checks. The goal of automating your checks is to make sure your code is always
in a good state. There are many tools out there that can help you automate your
checks (pre-commit, tox, etc&hellip;). I personally use pre-commit.</p>
<p>üõ†Ô∏è To install pre-commit, you can run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install pre-commit
</span></span></code></pre></div><p>Then you can run pre-commit</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pre-commit run --all-files
</span></span></code></pre></div><p><a href="/images/articles/python-project-setup/pre-commit.png"><img src="/images/articles/python-project-setup/pre-commit.png" alt="pre-commit"></a></p>
<ul>
<li>You can see on the image above that pre-commit is running the checks that we
defined in the <code>.pre-commit-config.yaml</code> file.</li>
<li>Note that this file is coming from the template above in
<a href="#4-add-some-code">step 4</a>.</li>
</ul>
<h2 id="8-automate-checks-on-remote-with-github-actions">8. Automate checks on remote with GitHub Actions</h2>
<p>üìö Now that you have some tests and some linters, you can start automating your
checks on the server side. The goal of automating your checks on the server side
is to make sure your code is always in a good state. There are many tools out
there that can help you automate your checks (GitHub Actions, Travis CI, Circle
CI, etc&hellip;). I personally use GitHub Actions.</p>
<p>üõ†Ô∏è To set up GitHub Actions, you can create a file called <code>.github/workflows/ci.yaml</code> and add the following code to it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">CI</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">lint</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Lint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">armand-sauzay/actions-python/lint@v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">github-token</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.GITHUB_TOKEN }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">test</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">armand-sauzay/actions-python/test@v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">github-token</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.GITHUB_TOKEN }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">test-flags</span><span class="p">:</span><span class="w"> </span>--<span class="l">version</span><span class="w">
</span></span></span></code></pre></div><p>Note that this file should already be created if you used the template mentionned above (see gh command in <a href="#4-add-some-code">step 4</a>.</p>
<p>Explanation:</p>
<ul>
<li>If you&rsquo;re not familiar with the syntax of GitHub Actions, you can read the <a href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions">documentation</a>.</li>
<li>Here we call two jobs: lint and test. Each job runs on ubuntu-latest (a Linux machine).</li>
<li>The lint job uses the <a href="https://github.com/armand-sauzay/actions-python/tree/main/lint">armand-sauzay/actions-python/lint</a> action to run pre-commit.</li>
<li>The test job uses the <a href="https://github.com/armand-sauzay/actions-python/tree/main/test">armand-sauzay/actions-python/test</a> action to run pytest. Here we pass a flag to pytest to just have a dummy test. You can remove this flag to run your actual tests.</li>
</ul>
<p><a href="/images/articles/python-project-setup/remote-checks.png"><img src="/images/articles/python-project-setup/remote-checks.png" alt="remote-checks"></a></p>
<h2 id="9-automate-your-release-with-github-actions">9. Automate your release with GitHub Actions</h2>
<p>üìö We have briefly talked about linting - using black, flake8, isort and mypy - and testing - using pytest. Release is an equally important concept that allows you to give versions to</p>
<p>üõ†Ô∏è To set up GitHub Actions, you can create a file called <code>.github/workflows/release.yaml</code> and add the following code to it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Release</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span><span class="w"> </span><span class="c"># enable manual release</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">lint</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Lint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">armand-sauzay/actions-python/lint@v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">github-token</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.GITHUB_TOKEN }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">test</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">armand-sauzay/actions-python/test@v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">github-token</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.GITHUB_TOKEN }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">test-flags</span><span class="p">:</span><span class="w"> </span>--<span class="l">version</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">release</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Release</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">lint, test]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">new-release-published</span><span class="p">:</span><span class="w"> </span><span class="l">${{ steps.release.outputs.new-release-published }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">new-release-version</span><span class="p">:</span><span class="w"> </span><span class="l">${{ steps.release.outputs.new-release-version }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">armand-sauzay/actions-python/release@v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">release</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">github-token</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.ADMIN_TOKEN || secrets.GITHUB_TOKEN }}</span><span class="w">
</span></span></span></code></pre></div><p><a href="/images/articles/python-project-setup/release.png"><img src="/images/articles/python-project-setup/release.png" alt="release"></a></p>
<p>A few things worth noting:</p>
<ul>
<li>this workflow will trigger on push on the main branch and on manual trigger (workflow_dispatch)</li>
<li>it will run the lint and test jobs</li>
<li>it will then run the release job which is semantically versioning your code and creating a release on GitHub. In case you don&rsquo;t know what semantic versioning is, you can read the <a href="https://semver.org/">documentation</a>.</li>
<li>In order to follow semantic versioning, you can follow conventional commits (this is why the commits show up as <code>fix: ...</code> or <code>feat: ...</code> in the release notes). You can read more on <a href="https://www.conventionalcommits.org/en/v1.0.0/">conventional commits</a>.</li>
<li>Sometimes you might have a protected branch, for which the default GITHUB_TOKEN wouldn&rsquo;t have enough permissions to create a release. In that case, you can create a personal access token called <code>ADMIN_TOKEN</code> and give it the right permissions. You can then use this token in the workflow.</li>
</ul>
<h2 id="10-enjoy-the-benefits-of-your-new-code-practices">10. Enjoy the benefits of your new code practices</h2>
<p>Now you know how to:</p>
<ul>
<li>use pyenv to install different python versions</li>
<li>use poetry to manage your dependencies (poetry add/remove)</li>
<li>use pytest to test your python code</li>
<li>what linting is and how to use flake8, black, isort and mypy</li>
<li>use pre-commit to automate your checks on your local machine</li>
<li>use GitHub Actions to automate your checks on the server side</li>
</ul>
<p>Enjoy the benefits of your new code practices! üéâ</p>

  </div>
</article>

  </main>
  <footer class="py-5 text-center text-gray-500 text-sm mt-auto">
  <div class="mx-auto flex justify-center items-center gap-8 px-4">
    <div class="flex gap-8 items-center">
      <a href="https://github.com/armandsauzay" target="_blank" class="text-gray-500 hover:text-green-800" aria-label="GitHub">
        
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
      </a>
      <a href="https://linkedin.com/in/armandsauzay" target="_blank" class="text-gray-500 hover:text-green-800" aria-label="LinkedIn">
        
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-linkedin-icon lucide-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect width="4" height="12" x="2" y="9"/><circle cx="4" cy="4" r="2"/></svg>
      </a>
      <a href="mailto:sauzayarmand@gmail.com" class="text-gray-500 hover:text-green-800" aria-label="Email">
        
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail-icon lucide-mail"><path d="m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"/><rect x="2" y="4" width="20" height="16" rx="2"/></svg>
      </a>
    </div>
    <div class="font-medium text-sm">¬© armandsauzay</div>
  </div>
</footer>
</body>
</html>

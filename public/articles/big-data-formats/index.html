<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8" />
  <title>Armand Sauzay</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  
  <link rel="stylesheet" href="/css/output.css">
  
  
  <link rel="stylesheet" href="/css/syntax.css">
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="min-h-screen flex flex-col font-sans">
  <header>
  <div class="max-w-5xl mx-auto flex items-center justify-between px-6 py-5 border-b border-gray-200">
    <a href="/" class="text-green-800 font-bold text-xl hover:text-green-900">armandsauzay</a>
    <nav class="flex items-center space-x-8">
      <a href="/articles" class="flex items-center gap-1 text-gray-700 hover:text-green-800">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open-icon lucide-book-open"><path d="M12 7v14"/><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg>
        Articles
      </a>
      <a href="/projects" class="flex items-center gap-1 text-gray-700 hover:text-green-800">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-code-xml-icon lucide-code-xml"><path d="m18 16 4-4-4-4"/><path d="m6 8-4 4 4 4"/><path d="m14.5 4-5 16"/></svg>
        Projects
      </a>
      <a href="/creative-lab" class="flex items-center gap-1 text-gray-700 hover:text-green-800">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-brain-icon lucide-brain"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"/><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"/><path d="M3.477 10.896a4 4 0 0 1 .585-.396"/><path d="M19.938 10.5a4 4 0 0 1 .585.396"/><path d="M6 18a4 4 0 0 1-1.967-.516"/><path d="M19.967 17.484A4 4 0 0 1 18 18"/></svg>
        Creative Lab
      </a>
    </nav>
  </div>
</header>
  <main class="flex flex-1 flex-col">
    
<article class="mx-auto px-6 py-8" style="max-width: 44rem;">
  <header class="mb-12">
    <h1 class="text-4xl font-bold text-gray-900 mb-6">Which Data Format to Use For Your Big Data Project?</h1>
    
    
    
    
    
    <div class="mb-6">
      
<div class="flex items-center text-sm text-gray-500">
  <span>26 Oct 2023</span>
  <span class="px-2">•</span>
  <span>6 min read</span>
  
  <span class="px-2">•</span>
  <div class="flex flex-wrap gap-2">
    
    <span class="bg-gray-100 px-2 py-1 rounded text-xs">data-science</span>
    
    <span class="bg-gray-100 px-2 py-1 rounded text-xs">python</span>
    
    <span class="bg-gray-100 px-2 py-1 rounded text-xs">performance</span>
    
    <span class="bg-gray-100 px-2 py-1 rounded text-xs">big-data</span>
    
    <span class="bg-gray-100 px-2 py-1 rounded text-xs">programming</span>
    
  </div>
  
</div>
    </div>
  </header>
  
  <div class="article-content">
    <p>Choosing the right data format is crucial in Data Science projects, impacting everything from data read/write speeds to memory consumption and interoperability. This article explores seven popular serialization/deserialization formats in Python, focusing on their speed and memory usage implications.</p>
<p>Through the analysis, we&rsquo;ll also see how we can use profiling in Python (using the <code>cProfile</code> built-in module) and how we can get statistics on memory usage for specific files in your filesystem (using the <code>os</code> Python module).</p>
<p>Of course, each project has its specificities, beyond just speed and memory usage. But we&rsquo;ll draw some trends, that can hopefully be useful to shed light on which format we can choose for a given project.</p>
<h2 id="understanding-serialization-and-deserialization">Understanding Serialization and Deserialization</h2>
<blockquote>
<p>Serialization is the <strong>process</strong> of saving an object (in Python, a pandas DataFrame for example) to a format that can be saved to a file for later retrieval. Deserialization is the reverse process.</p></blockquote>
<p>A dataframe is a Python object and cannot be persisted as is. It needs to be translated to a file to be able to load this object at a later stage.</p>
<p>When you save a dataframe, you &ldquo;serialize&rdquo; the data. And when you load it back, you &ldquo;deserialize&rdquo; or translate it back to a language-readable (here Python-readable) format.</p>
<p>Certain formats are widely used because they are human-readable, such as JSON or CSV. <strong>These two formats are also used because they are language agnostic.</strong> Just like <a href="https://protobuf.dev/">protocol buffers</a>, which were originally developed by Google. JSON and Protocol buffer are also popular for APIs and enable sending data between different services written in different languages.</p>
<p>On the other hand, some formats, like Python&rsquo;s pickle, are language-specific and not ideal for transferring data between services in different programming languages. For example, for a machine learning use case, if a repository trains a model and serializes it in pickle, this file will only be able to be read from Python. So if the API that serves that machine learning model is written in Java, some transformations will have to be done before it can be used.</p>
<p>But for storing large data files, formats like CSV, JSON, and Protocol Buffers fall short in performance compared to more specialized formats like <a href="https://www.hdfgroup.org/solutions/hdf5/">HDF5</a>, <a href="https://www.databricks.com/glossary/what-is-parquet">Parquet</a>, <a href="https://arrow.apache.org/docs/python/feather.html">Feather</a> or <a href="https://cwiki.apache.org/confluence/display/hive/languagemanual+orc">ORC</a>.</p>
<p>When working with data in Python, <a href="https://pandas.pydata.org/">pandas</a> provide a convenient API to extract, transform and load data. Pandas supports a wide array of formats (all the supported ones can be found <a href="https://pandas.pydata.org/docs/user_guide/io.html">here</a>), among which we chose the seven most used formats and compared their performance: JSON, CSV, Parquet, Pickle, Feather, HDF5, and ORC.</p>
<h2 id="experimental-approach">Experimental approach</h2>
<p><strong>Speed</strong> and <strong>memory usage</strong> are two key components to look at when choosing the right data format for your project. But these vary based on both the size of the data, and which type of data is being used.</p>
<p>To do the analysis, we created 3 datasets that should cover most use cases: a number only dataframe, a strings-only dataframe and a dataframe with both numbers and strings. Each dataframe is 10,000 rows over 100 columns and are defined by the following code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_numbers_only</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;col</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl"><span class="n">df_strings_only</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;col</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl"><span class="n">df_mixed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()],</span> <span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;col</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)])</span>
</span></span></code></pre></div><p>For the memory usage, we just look at what is the size of the dataset when saved. To measure memory usage, we&rsquo;ll use Python&rsquo;s <code>os</code> module, and specifically <code>os.stat</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_numbers_only</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;df.csv&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">file_stats</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s1">&#39;df.csv&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">file_stats</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File Size in Bytes is </span><span class="si">{</span><span class="n">file_stats</span><span class="o">.</span><span class="n">st_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1">#this is in Bytes</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File Size in MegaBytes is </span><span class="si">{</span><span class="n">file_stats</span><span class="o">.</span><span class="n">st_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1">#here we convert bytes to Mb</span>
</span></span></code></pre></div><p>For the speed, we use Python&rsquo;s <a href="https://docs.python.org/3/library/profile.html">cProfile</a> library to profile the time taken by functions to execute. Here, we take a window of 10 seconds and look at how many times the function executed. In essence:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">serialize_csv</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Serialize df to csv.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;test.csv&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">func</span> <span class="o">=</span> <span class="n">serialize_csv</span>
</span></span><span class="line"><span class="cl"><span class="n">args</span> <span class="o">=</span> <span class="n">df_numbers_only</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">timer</span> <span class="o">=</span> <span class="n">pytool</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Timer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">duration</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">cProfile</span><span class="o">.</span><span class="n">Profile</span><span class="p">()</span> <span class="k">as</span> <span class="n">profile</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">timer</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">&lt;</span> <span class="n">duration</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">time_results</span><span class="p">[(</span><span class="n">df_name</span><span class="p">,</span> <span class="n">file_format</span><span class="p">,</span> <span class="n">operation</span><span class="p">)]</span> <span class="o">=</span> <span class="n">profile</span>
</span></span></code></pre></div><h2 id="assessing-speed-how-fast-are-the-different-formats">Assessing speed: how fast are the different formats?</h2>
<p>Delving straight into the heart of the analysis, let&rsquo;s look at the graphs created for evaluating serialization/deserialization speed. Note that we scale the time it took, so you can see on the graph below that csv with numbers only is the slowest process while using HDF5 for numbers only is the fastest, taking 1.09% (roughly 1/100) of the CSV one.</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1000/1*E-H0u7NN_PGrwrBiHKiGOw.png" alt="Save time by format"></p>
<p style="text-align: center; font-style: italic; color: #666;">Image by author: save time by format</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1000/1*pZVa86kPSwV0RGbSBopIBQ.png" alt="Load time by format"></p>
<p style="text-align: center; font-style: italic; color: #666;">Image by author: load time by format</p>
<p>On the graphs above, we can observe a few interesting take aways in terms of speed:</p>
<ul>
<li><strong>Pickle/HDF5</strong> are the fastest to save number-only data</li>
<li><strong>Feather</strong> is the fastest format to load the data.</li>
<li>Human readable formats such as <strong>JSON</strong> or <strong>CSV</strong> are much slower than other formats, especially for saving/loading data that only contains numbers (almost 100x slower than pickle for instance)</li>
<li><strong>HDF5</strong> is interestingly very performant for saving data (on par with feather, parquet, pickle) but a bit less for loading data.</li>
</ul>
<h2 id="memory-usage-which-format-consumes-less-space">Memory usage: which format consumes less space?</h2>
<p><img src="https://miro.medium.com/v2/resize:fit:1000/1*dZYspLJiEVSQhB-jlUQkHA.png" alt="Memory usage by format"></p>
<p style="text-align: center; font-style: italic; color: #666;">Image by author: scaled memory usage</p>
<p>We can observe that:</p>
<ul>
<li>once again, human-readable formats such as <strong>CSV or JSON</strong> are the least memory efficient formats. And JSON performs even worse than CSV.</li>
<li><strong>parquet</strong> is the most memory efficient format with the given size of the data (10,000x100), which makes sense given parquet is a column-oriented data format. You can read more about it <a href="https://www.databricks.com/glossary/what-is-parquet">here</a>.</li>
<li>once again, when dealing solely with numerical data, <strong>pickle</strong> is the most efficient format. <a href="https://docs.python.org/3/library/pickle.html">Pickle</a> being the native Python package for serialization, it is not surprising.</li>
<li>while faster, <strong>feather</strong> data takes a lot more memory compared to parquet.</li>
</ul>
<p>The findings can be summarized on the following table (with a bit less nuance than the analysis above):</p>
<h2 id="conclusions">Conclusions</h2>
<p>The right format always boils down to your project&rsquo;s unique demands. But we can still draw general conclusions from the above analysis. For example, unless interoperability is key and you need to visually see what the raw data looks like, you&rsquo;re better off not using human-readable formats such as <strong>CSV or JSON</strong>.</p>
<p>Overall, <strong>parquet</strong> seems to be a very solid choice as it is much better on the memory usage side of things while still being relatively fast.</p>
<p>It is also pivotal to understand the specificities of each format. For example, pickle is Python specific so you won&rsquo;t be able to read it from other languages. But for Python-centric projects, focused solely on numerical data handling, <strong>pickle</strong> seems to be the best choice (both in terms of speed and memory).</p>
<p>If you&rsquo;re managing a lot of data and want to minimize the amount of GB you&rsquo;re writing to disk, <strong>parquet</strong> is the way to go. But if speed is your primary focus, you might want to give <strong>feather</strong> a try but it will take more memory.</p>
<p>Long story short, only the specific requirements of your project will guide you towards the right format. But you can hopefully gain some insights from the above to get a grasp on which one is better in your specific case.</p>

  </div>
</article>

  </main>
  <footer class="py-5 text-center text-gray-500 text-sm mt-auto">
  <div class="mx-auto flex justify-center items-center gap-8 px-4">
    <div class="flex gap-8 items-center">
      <a href="https://github.com/armandsauzay" target="_blank" class="text-gray-500 hover:text-green-800" aria-label="GitHub">
        
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
      </a>
      <a href="https://linkedin.com/in/armandsauzay" target="_blank" class="text-gray-500 hover:text-green-800" aria-label="LinkedIn">
        
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-linkedin-icon lucide-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect width="4" height="12" x="2" y="9"/><circle cx="4" cy="4" r="2"/></svg>
      </a>
      <a href="mailto:sauzayarmand@gmail.com" class="text-gray-500 hover:text-green-800" aria-label="Email">
        
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail-icon lucide-mail"><path d="m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"/><rect x="2" y="4" width="20" height="16" rx="2"/></svg>
      </a>
    </div>
    <div class="font-medium text-sm">© armandsauzay</div>
  </div>
</footer>
</body>
</html>

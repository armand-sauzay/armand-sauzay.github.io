1:"$Sreact.fragment"
2:I[48173,["173","static/chunks/173-24113e259ce525da.js","292","static/chunks/app/articles/page-9a53c5301fbc680c.js"],""]
3:I[15244,[],""]
4:I[43866,[],""]
6:I[86213,[],"OutletBoundary"]
8:I[86213,[],"MetadataBoundary"]
a:I[86213,[],"ViewportBoundary"]
c:I[34835,[],""]
:HL["/_next/static/media/a34f9d1faa5f3315-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/css/27c4eb1be0a8ef66.css","style"]
0:{"P":null,"b":"PQfJs3TWpIcT2jSkPpTci","p":"","c":["","articles","shap-values-machine-learning-interpretability"],"i":false,"f":[[["",{"children":["articles",{"children":[["slug","shap-values-machine-learning-interpretability","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/27c4eb1be0a8ef66.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__className_d65c78 min-h-screen flex flex-col","children":[["$","div",null,{"children":[["$","nav",null,{"className":"p-6","children":["$","div",null,{"className":"max-w-4xl mx-auto flex justify-between items-center","children":[["$","$L2",null,{"href":"/","className":"text-[#005530] font-semibold text-xl","children":"armandsauzay"}],["$","div",null,{"className":"flex gap-6","children":[["$","$L2",null,{"href":"/articles","className":"text-gray-600 hover:text-[#24512B] transition-colors flex items-center gap-2 cursor-pointer","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-book-open h-5 w-5","children":[["$","path","1akyts",{"d":"M12 7v14"}],["$","path","ruj8y",{"d":"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"}],"$undefined"]}],["$","span",null,{"children":"Articles"}]]}],["$","$L2",null,{"href":"/projects","className":"text-gray-600 hover:text-[#24512B] transition-colors flex items-center gap-2 cursor-pointer","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-code-xml h-5 w-5","children":[["$","path","1inbqp",{"d":"m18 16 4-4-4-4"}],["$","path","15zrgr",{"d":"m6 8-4 4 4 4"}],["$","path","e7oirm",{"d":"m14.5 4-5 16"}],"$undefined"]}],["$","span",null,{"children":"Projects"}]]}],["$","$L2",null,{"href":"/creative-lab","className":"text-gray-600 hover:text-[#24512B] transition-colors flex items-center gap-2 cursor-pointer","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-brain h-5 w-5","children":[["$","path","l5xja",{"d":"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"}],["$","path","ep3f8r",{"d":"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"}],["$","path","1p4c4q",{"d":"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"}],["$","path","tmeiqw",{"d":"M17.599 6.5a3 3 0 0 0 .399-1.375"}],["$","path","105sqy",{"d":"M6.003 5.125A3 3 0 0 0 6.401 6.5"}],["$","path","ql3yin",{"d":"M3.477 10.896a4 4 0 0 1 .585-.396"}],["$","path","1qfode",{"d":"M19.938 10.5a4 4 0 0 1 .585.396"}],["$","path","2e4loj",{"d":"M6 18a4 4 0 0 1-1.967-.516"}],["$","path","159ez6",{"d":"M19.967 17.484A4 4 0 0 1 18 18"}],"$undefined"]}],["$","span",null,{"children":"Creative Lab"}]]}]]}]]}]}],["$","div",null,{"className":"max-w-4xl mx-auto border-b border-gray-200"}]]}],["$","main",null,{"className":"flex-1 flex flex-col items-center justify-center","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[],[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]]],"forbidden":"$undefined","unauthorized":"$undefined"}]}],["$","footer",null,{"className":"w-full flex justify-center items-center gap-4 p-6 text-sm text-gray-500 mt-auto","children":[["$","div",null,{"className":"flex gap-8 items-center ","children":[["$","$L2",null,{"href":"https://github.com/armand-sauzay","className":"text-gray-500 hover:text-[#24512B] transition-transform transform hover:scale-110 ","target":"_blank","rel":"noopener noreferrer","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-github h-4 w-4","style":{"width":16,"height":16},"children":[["$","path","tonef",{"d":"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"}],["$","path","9comsn",{"d":"M9 18c-4.51 2-5-2-7-2"}],"$undefined"]}],["$","span",null,{"className":"sr-only","children":"GitHub"}]]}],["$","$L2",null,{"href":"https://linkedin.com/in/armandsauzay","className":"text-gray-500 hover:text-[#24512B] transition-transform transform hover:scale-110 ","target":"_blank","rel":"noopener noreferrer","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-linkedin h-4 w-4","style":{"width":16,"height":16},"children":[["$","path","c2jq9f",{"d":"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"}],["$","rect","mk3on5",{"width":"4","height":"12","x":"2","y":"9"}],["$","circle","bt5ra8",{"cx":"4","cy":"4","r":"2"}],"$undefined"]}],["$","span",null,{"className":"sr-only","children":"LinkedIn"}]]}],["$","$L2",null,{"href":"mailto:sauzayarmand@gmail.com","className":"text-gray-500 hover:text-[#24512B] transition-transform transform hover:scale-110 ","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-mail h-4 w-4","style":{"width":16,"height":16},"children":[["$","rect","18n3k1",{"width":"20","height":"16","x":"2","y":"4","rx":"2"}],["$","path","1ocrg3",{"d":"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"}],"$undefined"]}],["$","span",null,{"className":"sr-only","children":"Email"}]]}]]}],["$","span",null,{"className":"text-gray-400","children":"Â© armand sauzay"}]]}]]}]}]]}],{"children":["articles",["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","articles","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["slug","shap-values-machine-learning-interpretability","d"],["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","articles","children","$0:f:0:1:2:children:2:children:0","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L5",null,["$","$L6",null,{"children":"$L7"}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","pFQfy9yoAo5fi5LfdHsHa",{"children":[["$","$L8",null,{"children":"$L9"}],["$","$La",null,{"children":"$Lb"}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}]]}],false]],"m":"$undefined","G":["$c","$undefined"],"s":false,"S":true}
b:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
9:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Armand Sauzay"}],["$","meta","2",{"name":"description","content":"Personal website of Armand Sauzay"}],["$","link","3",{"rel":"icon","href":"/favicon.ico"}]]
7:null
d:I[95958,["313","static/chunks/313-6cc61c2fd8ca5084.js","904","static/chunks/app/articles/%5Bslug%5D/page-444914622aa9eeee.js"],"default"]
e:T21eb,This article lives on: 
- [Meduim](https://medium.com/@armand-sauzay/shap-values-machine-learning-interpretability-and-feature-selection-made-easy-feb8765f815b)
- [Dev.to](https://dev.to/armandsauzay/shap-values-machine-learning-interpretability-and-feature-selection-made-easy-396k)

# SHAP values: Machine Learning interpretability and feature selection madeÂ easy.
Machine learning interpretability with hands on code withÂ SHAP.

![Photo by Edu Grande onÂ Unsplash](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9q9Wr6rz5Li6IZcgLD7_Ig.jpeg)
<p align="center">Photo by Edu Grande onÂ Unsplash</p>

Machine Learning interpretability is becoming increasingly important, especially as ML algorithms are getting more complex.

How good is your Machine Learning algorithm if it cant be explained? Less performant but explainable models (like linear regression) are sometimes preferred over more performant but black box models (like XGBoost or Neural Networks). This is why research around machine learning explainability (aka eXplainable AI or XAI) has recently been a growing field with amazing projects like SHAP emerging.

> Would you feel confident using a machine learning model if you can't explain what it does?

This is where SHAP can be of great help: it can explain **any ML model** by giving the influence of each of the features on the target. But this is not all that SHAP can do. 

Build a simple model (sklearn/xgboost/keras) and use SHAP: you now have a feature selection process by looking at features which have the biggest impact on the prediction.
But how does SHAP work under the hood? And how can you start using it?

In this article we'll first get our hands on some python code to see how you can start using SHAP and how it can help you both for explainability and feature selection. 

Then, for those of you who want to get into the details of SHAP, we'll go through the theory behind popular XAI tools like SHAP and LIME.

---

All the code for this tutorial can be found on Kaggle [here](https://www.kaggle.com/code/armandsauzay/shap-interpret-any-ml-model-feature-selection?scriptVersionId=99746743). Feel free to run the notebook yourself or create aÂ copy!

---

## 1. How can you start usingÂ SHAP?

Here, we'll go through a simple example with Shap values using the competition Kaggle competition "House Prices - Advanced Regression Techniques" to illustrate SHAP. If you are interested or you have never been on Kaggle before, feel free to read more about the data and the competition itself here.

The process to use shap is quite straightforward: we need to build a model and then use the shap library to explain it.
![Explanation of how to use SHAP in your Machine Learning Project](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BG6W1B8OW6gUVHPbBXIvIA.png)

understand the output of yourÂ modelHere, our machine learning model tries to predict the house prices from the data that is given (number of square feet, quality, number of floors etc).

The usual workflow in terms of code looks like this:
1. Create an estimator. For instance GradientBoostingRegressor from sklearn.ensemble:
    ```python
    estimator = GradientBoostingRegressor(random_state = random_state)
    ```
2. Train your estimator:
    ```python
    estimator.fit(X_train, y_train)
    ```
3. use shap library to calculate the SHAP values. For instance, using the following code:
    ```python
    explainer = shap.Explainer(estimator.predict, X100)
    shap_values = explainer(X100)
    ```
4. See what is the impact of each feature using shap.summary_plot:
    ```python 
    shap.summary_plot(shap_values, max_display=15, show=False)
    shap.summary_plot(shap_values, max_display=15, show=False)
    ```
![Summary plot of feature importance](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9M6mMjsGH_nj0BG_7uJpCg.png)

For instance, you can see here that OverallQual is the feature that has the most impact on the model output. High values (colored in red on the graph above) of OverallQual can increase a property's price by ~60,000 and low values can decrease a price by ~20,000. Interesting to know if you're in real estate, isn't it?

But this is not all of what SHAP can do! SHAP can also explain a single prediction.

For example, using shap.plots.waterfall for a single element in the dataset, you can have the following:
```python
shap.plots.waterfall(shap_values[sample_index], max_display=14)
```
![Waterfall plot of feature importance for a single example](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AGEnQK781FHnjEwexOklbg.png)

For this specific example, the predicted price was 166k (vs 174k on average). And we can understand why the algorithm predicted such: for instance OverallQual which is high (7) drives the value up but YearBuilt (1925) drives the value down.

You can now understand the dynamics behind your model, both overall and on specific datapoints. With SHAP, you can more easily see if something is wrong (or does not make sense for your sharpened data science mind) so you can correct it! This is what observability is about.

And since SHAP allows you to understand the feature importance of your model, you can also use this for feature selection. For instance
```python 
shap.summary_plot(shap_values, max_display=15, show=False, plot_type='bar')
```
![Barplot of feature importance](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LPp8lnK6n2peGk1wbBb8Og.png)

Then you can see which features do not have a lot of impact on the output of the model. The features usually are noise for your machine learning model and do not bring a lot of predictive value. So removing them from your training set will generally improve the performance, and allow you to tune correctly the hyper parameters without overfitting on noisy data.
![Worfklow for feature selection in your machine learning project](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zI3DWLj7E71y4jyVHHJx9g.png)
<p align="center"> How SHAP can be used for feature selection </p>


## 2. Quick overview: How does SHAP work under theÂ hood?

If you have a bit of time, feel free to read the original paper that describes the different approaches for model explainability and goes through the advantages of SHAP.

But let's try to explain in short what SHAP is doing and the concepts behind without getting too deep into the mathematical equations.

Explainable Machine Learning (aka eXplainable AI or XAI) aims at understanding why the output of a machine learning model is such. To do so, you could theoretically take the definition of your model, for example a tree based model like Random Forest, and then see why your output is such. But this is not so straightforward, and of course, it gets even more complex for Deep Learning modelsâ¦

Instead of going through the winding path of understanding what happens inside your model (forward and backward propagation for deep learning models, which splits are the most used in your RF algo etc). But once you have your trained model, could you not instead use it to see how it reacts when you change a feature?

This is the core concept behind popular XAI algorithm (SHAP, LIME etc): use your existing model, approximate it using an explainable model and you now have an explainable model. The complexity is now on how to approximate a ML model around a given prediction, and then around most predictions.

If you are interested in this and want to learn more, let me know and I'll write a follow up article on the mathematical concepts behind SHAP, how it is related to the classic Shapley values, how you can compute SHAP values and how we are able to approximate it for specific use cases, which makes the computation easier.

---

Woohoo! You now know the basics on how SHAP works and how you can start using it right away in your machine learning projects!

---

I hope you liked this article! Let me know if you have any questions or suggestions. Also feel free to contact me on LinkedIn, GitHub or Twitter, or checkout some other tutorials I wrote on DS/ML best practices. Happy learning!

Sources:
- [official documentation](https://shap.readthedocs.io/en/latest/index.html)
- [original paper](https://proceedings.neurips.cc/paper/2017/file/8a20a8621978632d76c43dfd28b67767-Paper.pdf)

## About me
Hey! ð I'm Armand Sauzay ([armandsauzay](https://twitter.com/armandsauzay)). You can find, follow or contact me on: 

- [Github](https://github.com/armand-sauzay) 
- [Twitter](https://twitter.com/armandsauzay)
- [LinkedIn](https://www.linkedin.com/in/armand-sauzay-80a70b160/)
- [Medium](https://medium.com/@armand-sauzay)
- [Dev.to](https://dev.to/armandsauzay)5:["$","div",null,{"className":"min-h-screen flex flex-col","children":["$","main",null,{"className":"flex-1 max-w-4xl mx-auto px-4 py-16","children":["$","$Ld",null,{"markdown":"$e","markdownUrl":"https://raw.githubusercontent.com/armand-sauzay/blog-posts/main/shap-values-machine-learning-interpretability-and-feature-selection-made-easy/README.md"}]}]}]
